<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Excel Viewer – Highlight Search</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f7fa;
    }

    #author {
        font-size: 22px;
        font-weight: bold;
        color: #1d4ed8;
        margin-bottom: 20px;
    }

    #tabs {
        margin-top: 20px;
        margin-bottom: 10px;
    }

    .tab-btn {
        padding: 10px 16px;
        margin-right: 8px;
        border: none;
        background: #e2e8f0;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }

    .tab-btn.active {
        background: #2563eb;
        color: white;
    }

    .sheet-content {
        display: none;
        padding: 15px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-top: 10px;
    }

    .search-box {
        margin-bottom: 12px;
    }

    .search-input {
        padding: 8px;
        width: 260px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    /* highlight giống ctrl+f */
    .highlight {
        background: yellow !important;
        color: black !important;
        font-weight: bold;
    }
</style>

</head>
<body>

<div id="author">CREATED BY HẢI 9</div>

<h1>Đọc Excel – Tabs + Highlight Search + Giữ màu Excel</h1>

<input type="file" id="excelFile" accept=".xlsx,.xls" />

<div id="tabs"></div>
<div id="result"></div>

<script>
document.getElementById("excelFile").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(evt) {
        const data = evt.target.result;
        const workbook = XLSX.read(data, {
            type: "binary",
            cellStyles: true
        });

        const validSheets = ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"];

        const tabsDiv = document.getElementById("tabs");
        const resultDiv = document.getElementById("result");

        tabsDiv.innerHTML = "";
        resultDiv.innerHTML = "";

        let firstSheet = null;

        validSheets.forEach(sheetName => {
            if (workbook.Sheets[sheetName]) {

                const btn = document.createElement("button");
                btn.className = "tab-btn";
                btn.textContent = sheetName;
                btn.onclick = () => showSheet(sheetName);
                tabsDiv.appendChild(btn);

                const html = XLSX.utils.sheet_to_html(workbook.Sheets[sheetName], {
                    cellStyles: true
                });

                const div = document.createElement("div");
                div.className = "sheet-content";
                div.id = "sheet-" + sheetName;

                div.innerHTML = `
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="Tìm giống Ctrl+F..." onkeyup="highlightSearch('${sheetName}', this.value)">
                    </div>
                    <div class="sheet-table">${html}</div>
                `;

                resultDiv.appendChild(div);

                if (!firstSheet) firstSheet = sheetName;
            }
        });

        if (firstSheet) showSheet(firstSheet);
    };

    reader.readAsBinaryString(file);
});

// -------------------------
// HIỆN SHEET ĐƯỢC CHỌN
// -------------------------
function showSheet(name) {
    document.querySelectorAll(".sheet-content").forEach(div => div.style.display = "none");
    document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));

    document.getElementById("sheet-" + name).style.display = "block";

    document.querySelectorAll(".tab-btn").forEach(btn => {
        if (btn.textContent === name) btn.classList.add("active");
    });
}

// -------------------------
// SEARCH GIỐNG CTRL + F
// -------------------------
function highlightSearch(sheetName, keyword) {
    const table = document.querySelector(`#sheet-${sheetName} table`);
    const cells = table.querySelectorAll("td, th");

    // xóa highlight cũ
    cells.forEach(cell => {
        cell.innerHTML = cell.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/g, "$1");
    });

    if (!keyword.trim()) return;

    const kw = keyword.toLowerCase();

    cells.forEach(cell => {
        const text = cell.innerText.toLowerCase();
        if (text.includes(kw)) {
            const original = cell.innerHTML;
            const regex = new RegExp(keyword, "gi");
            cell.innerHTML = original.replace(regex, match => `<span class="highlight">${match}</span>`);
        }
    });
}
</script>

</body>
</html>
